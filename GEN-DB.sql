SET TERMOUT ON
PROMPT Dropping old tables and rebuilding. Please stand by.
--SET TERMOUT OFF


DROP TABLE STUDENT CASCADE CONSTRAINTS;
DROP TABLE SUBJECT CASCADE CONSTRAINTS;
DROP TABLE COURSEWORK CASCADE CONSTRAINTS;
DROP TABLE COURSEWORKRESULT CASCADE CONSTRAINTS;
DROP TABLE EXAM CASCADE CONSTRAINTS;
DROP TABLE EXAMRESULT CASCADE CONSTRAINTS;
DROP TABLE LECTURER CASCADE CONSTRAINTS;
DROP TABLE QUESTION CASCADE CONSTRAINTS;

PROMPT All tables have been dropped.

--Block to create the subject table
CREATE TABLE SUBJECT(
        SUBJECT_ID NUMBER(10) NOT NULL,
        PRIMARY KEY (SUBJECT_ID),
        NAME VARCHAR(20) NOT NULL,
        DESCRIPTION VARCHAR(255) NOT NULL,
        SEMESTER NUMBER(2) NOT NULL
);

CREATE SEQUENCE Subject_seq START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER Subject_seq_tr
        BEFORE INSERT ON Student FOR EACH ROW
BEGIN
 SELECT Subject_seq.NEXTVAL INTO :NEW.SUBJECCT_ID FROM DUAL;
END;
/
-- End subject block

--Block to create the student table
CREATE TABLE STUDENT(
        STUDENT_ID NUMBER(10) NOT NULL,
        PRIMARY KEY (STUDENT_ID),
        FIRST_NAME VARCHAR(20) NOT NULL,
        LAST_NAME VARCHAR(20) NOT NULL,
        YEAR NUMBER(2) NOT NULL,
        SUBJECT_ID REFERENCES SUBJECT(SUBJECT_ID)
);

CREATE SEQUENCE Student_seq START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER Student_seq_tr
        BEFORE INSERT ON Student FOR EACH ROW
BEGIN
 SELECT Student_seq.NEXTVAL INTO :NEW.STUDENT_ID FROM DUAL;
END;
/

--End student block

CREATE TABLE COURSEWORK(
        COURSEWORK_ID NUMBER(10),
        PRIMARY KEY (COURSEWORK_ID),
        SUBJECT_ID REFERENCES SUBJECT(SUBJECT_ID),
        MAX_MARK NUMBER(10)
);


CREATE TABLE COURSEWORKRESULT(
        MARK_ACHIEVED NUMBER(10),
        STUDENT_ID REFERENCES STUDENT(STUDENT_ID),
        COURSEWORK_ID REFERENCES COURSEWORK(COURSEWORK_ID)
);


CREATE TABLE LECTURER(
        LECTURER_ID NUMBER(10),
        PRIMARY KEY (LECTURER_ID),
        TILE VARCHAR(10),
        FIRST_NAME VARCHAR(20),
        LAST_NAME VARCHAR(20),
        SUBJECT_ID REFERENCES SUBJECT(SUBJECT_ID),
        COURSEWORK_ID REFERENCES COURSEWORK(COURSEWORK_ID)
);


CREATE TABLE EXAM(
        EXAM_ID NUMBER(10),
        PRIMARY KEY (EXAM_ID),
        TOTAL_MARK NUMBER(10),
        RESIT VARCHAR(3),
        SUBJECT_ID REFERENCES SUBJECT(SUBJECT_ID)
);


CREATE TABLE EXAMRESULT(
        MARK_ACHIEVED NUMBER(10),
        STUDENT_ID REFERENCES STUDENT(STUDENT_ID),
        EXAM_ID REFERENCES EXAM(EXAM_ID)
);


CREATE TABLE QUESTION(
        QUESTION_ID NUMBER(10),
        PRIMARY KEY (QUESTION_ID),
        MAX_MARK NUMBER(10),
        AUTHOR VARCHAR (50),
        EXAM_ID REFERENCES EXAM(EXAM_ID),
        LECTURER_ID REFERENCES LECTURER(LECTURER_ID)
);


COMMIT;

SET TERMOUT OFF
PROMPT Building tables is complete.